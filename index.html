<!DOCTYPE html>
<html>
  <head>
    <title>A-Frame AR Camera Background</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      
      /* Video element - camera feed at the bottom layer */
      .camera-video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 0;
      }
      
      /* A-Frame scene - transparent overlay on top */
      a-scene {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }
      
      /* Make A-Frame canvas transparent */
      a-scene canvas {
        opacity: 1 !important;
        background: transparent !important;
      }
      
      /* Hide VR button */
      .a-enter-vr {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <!-- Camera stream video element -->
    <video id="camera-view" class="camera-video" autoplay playsinline muted></video>

    <!-- A-Frame AR scene -->
    <a-scene embedded vr-mode-ui="enabled: false">
      <!-- 3D content -->
      <a-box position="0 1.6 -3" rotation="0 45 0" color="#4CC3D9" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-box>
      
      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Start camera and ensure A-Frame canvas is transparent
      const cameraView = document.querySelector("#camera-view");
      const constraints = { 
        video: { 
          facingMode: "environment",
          width: { ideal: 1920 },
          height: { ideal: 1080 }
        }, 
        audio: false 
      };

      function cameraStart() {
        navigator.mediaDevices
          .getUserMedia(constraints)
          .then(function(stream) {
            cameraView.srcObject = stream;
            cameraView.play().catch(e => console.log("Video play error:", e));
          })
          .catch(function(error) {
            console.error("Camera access error:", error);
          });
      }

      // Ensure canvas is transparent after scene loads
      document.querySelector('a-scene').addEventListener('loaded', function() {
        const canvas = document.querySelector('a-scene canvas');
        if (canvas) {
          canvas.style.background = 'transparent';
        }
      });

      // Start camera
      window.addEventListener("load", cameraStart, false);
    </script>
  </body>
</html>
