<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame AR Camera Background</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      
      /* Start button overlay */
      #start-button {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        cursor: pointer;
      }
      
      #start-button button {
        padding: 20px 40px;
        font-size: 18px;
        background: #4CC3D9;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
      
      /* Video element - camera feed at the bottom layer */
      .camera-video {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 0;
        display: none;
      }
      
      /* A-Frame scene - transparent overlay on top */
      a-scene {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }
      
      /* Make A-Frame canvas transparent */
      a-scene canvas {
        opacity: 1 !important;
        background: transparent !important;
      }
      
      /* Hide VR button */
      .a-enter-vr {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <!-- Start button for mobile (required for camera access) -->
    <div id="start-button">
      <button>Tap to Start AR Camera</button>
    </div>

    <!-- Camera stream video element -->
    <video id="camera-view" class="camera-video" autoplay playsinline muted></video>

    <!-- A-Frame AR scene -->
    <a-scene embedded vr-mode-ui="enabled: false">
      <!-- 3D content -->
      <a-box position="0 1.6 -3" rotation="0 45 0" color="#4CC3D9" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-box>
      
      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const startButton = document.getElementById('start-button');
      const cameraView = document.getElementById('camera-view');
      
      const constraints = { 
        video: { 
          facingMode: "environment",
          width: { ideal: 1920 },
          height: { ideal: 1080 }
        }, 
        audio: false 
      };

      async function cameraStart() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          cameraView.srcObject = stream;
          cameraView.style.display = 'block';
          await cameraView.play();
        } catch (error) {
          console.error("Camera access error:", error);
          alert("Camera access denied or not available. Please allow camera permissions.");
        }
      }

      // Mobile: Start camera on user tap (required by mobile browsers)
      startButton.addEventListener('click', async function() {
        startButton.style.display = 'none';
        await cameraStart();
      });

      // Desktop: Also work on load
      window.addEventListener('load', function() {
        // Check if it's a mobile device
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        if (!isMobile) {
          // Desktop: try to start on load
          startButton.style.display = 'none';
          cameraStart().catch(e => console.log("Desktop camera error:", e));
        }
      });

      // Ensure canvas is transparent after scene loads
      document.querySelector('a-scene').addEventListener('loaded', function() {
        const canvas = document.querySelector('a-scene canvas');
        if (canvas) {
          canvas.style.background = 'transparent';
        }
      });
    </script>
  </body>
</html>
